apiVersion: kubermatic.k8c.io/v1
kind: PolicyTemplate
metadata:
  name: restrict-external-ips
spec:
  title: Restrict External IPs
  description: | 
      Service externalIPs can be used for a MITM attack (CVE-2020-8554).
      Restrict externalIPs or limit to a known set of addresses.
      See: https://github.com/kyverno/kyverno/issues/1367. This policy validates
      that the `externalIPs` field is not set on a Service.
  category: Best Practices
  severity: medium
  visibility: Global
  policySpec:
    validationFailureAction: Audit
    background: true
    rules:
    - name: check-ips
      match:
        any:
        - resources:
            kinds:
            - Service
      validate:
        message: "externalIPs are not allowed."
        pattern:
          spec:
            # restrict external IP addresses
            # you can alternatively restrict to a known set of addresses using:
            #     =(externalIPs): ["37.10.11.53", "153.10.20.1"]
            X(externalIPs): "null"