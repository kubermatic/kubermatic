apiVersion: kubermatic.k8c.io/v1
kind: PolicyTemplate
metadata:
  name: require-ro-rootfs
spec:
  title: Require Read-Only Root Filesystem
  description: | 
      A read-only root file system helps to enforce an immutable infrastructure strategy;
      the container only needs to write on the mounted volume that persists the state.
      An immutable root filesystem can also prevent malicious binaries from writing to the
      host system. This policy validates that containers define a securityContext
      with `readOnlyRootFilesystem: true`.
  category: Best Practices
  severity: medium
  visibility: Global
  policySpec:
    validationFailureAction: Audit
    background: true
    rules:
    - name: validate-readOnlyRootFilesystem
      match:
        any:
        - resources:
            kinds:
            - Pod
      validate:
        message: "Root filesystem must be read-only."
        pattern:
          spec:
            containers:
            - securityContext:
                readOnlyRootFilesystem: true
