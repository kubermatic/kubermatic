# Copyright 2025 The Kubermatic Kubernetes Platform contributors.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.15.0
  name: tenants.kubelb.k8c.io
spec:
  group: kubelb.k8c.io
  names:
    kind: Tenant
    listKind: TenantList
    plural: tenants
    singular: tenant
  scope: Cluster
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Tenant is the Schema for the tenants API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: TenantSpec defines the desired state of Tenant
            properties:
              allowedDomains:
                default:
                - '**'
                description: |-
                  List of allowed domains for the tenant. This is used to restrict the domains that can be used
                  for the tenant. If specified, applies on all the components such as Ingress, GatewayAPI, DNS, certificates, etc.
                  Examples:
                  - ["*.example.com"] -> this allows subdomains at the root level such as example.com and test.example.com but won't allow domains at one level above like test.test.example.com
                  - ["**.example.com"] -> this allows all subdomains of example.com such as test.dns.example.com and dns.example.com
                  - ["example.com"] -> this allows only example.com
                  - ["**"] or ["*"] -> this allows all domains
                  Note: "**" was added as a special case to allow any levels of subdomains that come before it. "*" works for only 1 level.
                  Default: value is ["**"] and all domains are allowed.
                items:
                  type: string
                type: array
              certificates:
                description: CertificatesSettings defines the settings for the certificates.
                properties:
                  allowedDomains:
                    description: |-
                      AllowedDomains is a list of allowed domains for automated Certificate management. Has a higher precedence than the value specified in the Config.
                      If empty, the value specified in `tenant.spec.allowedDomains` will be used.
                      Examples:
                      - ["*.example.com"] -> this allows subdomains at the root level such as example.com and test.example.com but won't allow domains at one level above like test.test.example.com
                      - ["**.example.com"] -> this allows all subdomains of example.com such as test.dns.example.com and dns.example.com
                      - ["example.com"] -> this allows only example.com
                      - ["**"] or ["*"] -> this allows all domains
                      Note: "**" was added as a special case to allow any levels of subdomains that come before it. "*" works for only 1 level.
                    items:
                      type: string
                    type: array
                  defaultClusterIssuer:
                    description: DefaultClusterIssuer is the Cluster Issuer to use
                      for the certificates by default. This is applied when the cluster
                      issuer is not specified in the annotations on the resource itself.
                    type: string
                  disable:
                    description: Disable is a flag that can be used to disable certificate
                      automation for a tenant.
                    type: boolean
                type: object
              defaultAnnotations:
                additionalProperties:
                  additionalProperties:
                    type: string
                  type: object
                description: |-
                  DefaultAnnotations defines the list of annotations(key-value pairs) that will be set on the load balancing resources if not already present. A special key `all` can be used to apply the same
                  set of annotations to all resources.
                  Tenant configuration has higher precedence than the annotations specified at the Config level.
                type: object
              dns:
                description: DNSSettings defines the settings for the DNS.
                properties:
                  allowedDomains:
                    description: |-
                      AllowedDomains is a list of allowed domains for automated DNS management. Has a higher precedence than the value specified in the Config.
                      If empty, the value specified in `tenant.spec.allowedDomains` will be used.
                      Examples:
                      - ["*.example.com"] -> this allows subdomains at the root level such as example.com and test.example.com but won't allow domains at one level above like test.test.example.com
                      - ["**.example.com"] -> this allows all subdomains of example.com such as test.dns.example.com and dns.example.com
                      - ["example.com"] -> this allows only example.com
                      - ["**"] or ["*"] -> this allows all domains
                      Note: "**" was added as a special case to allow any levels of subdomains that come before it. "*" works for only 1 level.
                    items:
                      type: string
                    type: array
                  disable:
                    description: Disable is a flag that can be used to disable DNS
                      automation for a tenant.
                    type: boolean
                type: object
              gatewayAPI:
                description: GatewayAPISettings defines the settings for the gateway
                  API.
                properties:
                  class:
                    description: |-
                      Class is the class of the gateway API to use. This can be used to specify a specific gateway API implementation.
                      This has higher precedence than the value specified in the Config.
                    type: string
                  disable:
                    description: Disable is a flag that can be used to disable Gateway
                      API for a tenant.
                    type: boolean
                  disableGRPCRoute:
                    type: boolean
                  disableHTTPRoute:
                    type: boolean
                  disableTCPRoute:
                    type: boolean
                  disableTLSRoute:
                    type: boolean
                  disableUDPRoute:
                    type: boolean
                  gateway:
                    description: GatewaySettings defines the settings for the gateway
                      resource.
                    properties:
                      limit:
                        description: |-
                          Limit is the maximum number of gateways to create.
                          If a lower limit is set than the number of reources that exist, the limit will be disallow creation of new resources but will not delete existing resources. The reason behind this
                          is that it is not possible for KubeLB to know which resources are safe to remove.
                        type: integer
                    type: object
                type: object
              ingress:
                description: IngressSettings defines the settings for the ingress.
                properties:
                  class:
                    description: |-
                      Class is the class of the ingress to use.
                      This has higher precedence than the value specified in the Config.
                    type: string
                  disable:
                    description: Disable is a flag that can be used to disable Ingress
                      for a tenant.
                    type: boolean
                type: object
              loadBalancer:
                description: LoadBalancerSettings defines the settings for the load
                  balancers.
                properties:
                  class:
                    description: |-
                      Class is the class of the load balancer to use.
                      This has higher precedence than the value specified in the Config.
                    type: string
                  disable:
                    description: Disable is a flag that can be used to disable L4
                      load balancing for a tenant.
                    type: boolean
                  limit:
                    description: |-
                      Limit is the maximum number of load balancers to create.
                      If a lower limit is set than the number of reources that exist, the limit will be disallow creation of new resources but will not delete existing resources. The reason behind this
                      is that it is not possible for KubeLB to know which resources are safe to remove.
                    type: integer
                type: object
              propagateAllAnnotations:
                description: |-
                  PropagateAllAnnotations defines whether all annotations will be propagated to the LoadBalancer service. If set to true, PropagatedAnnotations will be ignored.
                  Tenant configuration has higher precedence than the value specified at the Config level.
                type: boolean
              propagatedAnnotations:
                additionalProperties:
                  type: string
                description: |-
                  PropagatedAnnotations defines the list of annotations(key-value pairs) that will be propagated to the LoadBalancer service. Keep the `value` field empty in the key-value pair to allow any value.
                  Tenant configuration has higher precedence than the annotations specified at the Config level.
                type: object
            type: object
          status:
            description: TenantStatus defines the observed state of Tenant
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
