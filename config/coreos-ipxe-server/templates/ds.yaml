apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
  labels:
    role: coreos-ipxe-server
  name: coreos-ipxe-server
  namespace: coreos-ipxe-server
spec:
  template:
    metadata:
      labels:
        role: coreos-ipxe-server
    spec:
      hostNetwork: true
      containers:
      - env:
          - name: COREOS_IPXE_SERVER_DATA_DIR
            valueFrom:
              configMapKeyRef:
                name: coreos-ipxe-server-configmap
                key: dataDirectory
          - name: COREOS_IPXE_SERVER_BASE_URL
            valueFrom:
              configMapKeyRef:
                name: coreos-ipxe-server-configmap
                key: baseURL
          - name: COREOS_IPXE_SERVER_LISTEN_ADDR
            valueFrom:
              configMapKeyRef:
                name: coreos-ipxe-server-configmap
                key: listenAddress
          - name: COREOS_IPXE_SERVER_DEFAULT_PROFILE
            valueFrom:
              configMapKeyRef:
                name: coreos-ipxe-server-configmap
                key: defaultProfile
        image: kubermatic/coreos-ipxe-server:latest
        imagePullPolicy: Always
        name: coreos-ipxe-server
        ports:
        - containerPort: 4777
          name: ipxe
        volumeMounts:
        - name: coreos-ipxe-server-cloud-configs
          mountPath: /opt/coreos-ipxe-server/configs
        - name: coreos-ipxe-server-profiles
          mountPath: /opt/coreos-ipxe-server/profiles
      volumes:
      - configMap:
          name: coreos-ipxe-server-cloud-configs
        name: coreos-ipxe-server-cloud-configs
      - configMap:
          name: coreos-ipxe-server-profiles
        name: coreos-ipxe-server-profiles
