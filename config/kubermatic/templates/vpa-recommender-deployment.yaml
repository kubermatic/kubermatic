{{ if (contains "VerticalPodAutoscaler=true" .Values.kubermatic.controller.featureGates) }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: vpa-recommender
  namespace: kube-system
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: vpa-recommender
  namespace: kube-system
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: vpa-recommender
      annotations:
        fluentbit.io/parser: glog
    spec:
      serviceAccountName: vpa-recommender
      containers:
      - name: recommender
        image: {{ .Values.kubermatic.vpa.recommender.image.repository }}:{{ .Values.kubermatic.vpa.recommender.image.tag }}
        command: ["/recommender"]
        args: [
          "--address", ":8942",
          "--kube-api-burst", "20",
          "--kube-api-qps", "10",
          "--logtostderr",
          "--v", "4",
          "--storage", "prometheus",
          "--prometheus-address","http://prometheus-kubermatic.monitoring.svc.cluster.local:9090",
          "--prometheus-cadvisor-job-name", "cadvisor-vpa",
          "--recommendation-margin-fraction", "0",
        ]
        resources:
{{ toYaml .Values.kubermatic.vpa.recommender.resources | indent 10 }}
        ports:
        - containerPort: 8080
        {{ end }}
