groups:
- name: ark
  rules:
  - alert: ArkBackupTakesTooLong
    annotations:
      message: Backup schedule {{ $labels.schedule }} has been taking more than 60min already.
      runbook_url: https://docs.kubermatic.io/monitoring/runbook/#alert-arkbackuptakestoolong
    expr: (ark_backup_attempt_total - ark_backup_success_total) > 0
    for: 60m
    labels:
      severity: warning
    runbook:
      steps:
      - Check if a backup is really in "InProgress" state via `ark -n ark backup get`.
      - Check the backup logs via `ark -n ark backup logs [BACKUP_NAME]`.
      - Depending on the backup, find the pod and check the processes inside that pod or any sidecar containers.

  - alert: ArkNoRecentBackup
    annotations:
      message: There has not been a successful backup for schedule {{ $labels.schedule }} in the last 24 hours.
      runbook_url: https://docs.kubermatic.io/monitoring/runbook/#alert-arknorecentbackup
    expr: changes(ark_backup_success_total{schedule!=""}[25h]) < 1
    labels:
      severity: warning
    runbook:
      steps:
      - Check if really no backups happened via `ark -n ark backup get`.
      - If a backup failed, check its logs via `ark -n ark backup logs [BACKUP_NAME]`.
      - If a backup was not even triggered, check the Ark server's logs via `kubectl -n ark logs -l 'name=ark-server'`.
