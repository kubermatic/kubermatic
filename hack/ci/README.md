# Scripts list and their description

This file is generated by running `hack/meta.sh`.

## canary-github-release.sh

This script is run for every commit to main and will create
a dummy release in a dedicated GitHub repo. The purpose is to

* test that releasing code actually works, and
* to provide test builds for internal purposes.

## deploy-dev.sh

This script is used as a postsubmit job and updates the dev master
cluster after every commit to main.

## deploy.sh

This script is used by all other `deploy-*` scripts to handle the
common deployment logic. It can setup the main, monitoring and logging
stacks by updating the Helm charts on the target cluster.

## download-gocache.sh

This script is used when building Go binaries to download a prewarmed
cache for `$GOCACHE`. This is an uncompressed tar archive in a local
S3-compatible storage, which is just downloaded and extracted. This
significantly speeds up CI jobs, as much fewer packages have to be
compiled.

A dedicated postsubmit job that runs after every change to the main
branch is keeping the cache up-to-date.

## fetch-chart-dependencies.sh

This script fetches dependencies for a chart, based on the lock file
contained within the charts' directory. The script iterates over all charts.

## github-release.sh

This script is run for every tagged revision and will create
the appropriate GitHub release and upload source archives. It can be
tweaked by setting a number of environment variables, most importantly:

* `DRY_RUN=false` - set to `true` to not actually talk to GitHub
* `GITHUB_TOKEN` - the OAuth token to use

Whenever this is changed, run the optional `pre-kubermatic-simulate-github-release`
job to (mostly) ensure that the changes will work.

## release-images.sh

This script compiles the KKP binaries and then builds and pushes all
container images by using `hack/release-images.sh`. It is only
useful as part of another script to setup KKP for testing.

## run-cilium-e2e-test.sh

This script is used as a postsubmit job and updates the dev master
cluster after every commit to main.

## run-conformance-tests.sh

After having set up a local KKP installation, this script is then
used to run the conformance-tester for a given cloud provider.

## run-dualstack-e2e-test.sh

TBD

## run-e2e-tests.sh

This script sets up a local KKP installation in kind and then
runs the conformance-tester to create userclusters and check their
Kubernetes conformance.

## run-etcd-launcher-tests.sh

This script sets up a local KKP installation in kind, deploys a
couple of test Presets and Users and then runs the etcd-launcher tests.

## run-ipam-e2e-tests.sh

This script sets up a local KKP installation in kind, deploys a
couple of test Presets and Users and then runs the IPAM e2e tests.

## run-konnectivity-e2e-test.sh

This script is used as a postsubmit job and updates the dev master
cluster after every commit to main.

## run-mla-e2e-tests.sh

This script sets up a local KKP installation in kind, deploys a
couple of test Presets and Users and then runs the MLA e2e tests.

## run-offline-test.sh

This script was used to run KKP conformance tests inside an offline
environment.

TODO: This needs to be cleaned up greatly and adjusted to the KKP
Operator. The presubmit job for this script is currently not used.

## run-opa-e2e-tests.sh

This script sets up a local KKP installation in kind, deploys a
couple of test Presets and Users and then runs the OPA e2e tests.

## run-user-ssh-key-agent-tests.sh

This script tests whether we can successfully build the multiarch
version for the user-ssh-key-agent.

## setup-kind-cluster.sh

TBD

## setup-kubermatic-backups-in-kind.sh

This script creates a local kind cluster, compiles the KKP binaries,
creates all Docker images and loads them into the kind cluster,
generates a custom CA and a certificate for minio to be used as backup location,
then installs KKP using the KKP installer + operator and sets up a
single shared master/seed system.
This serves as the precursor for all other tests.

This script should be sourced, not called, so callers get the variables
it sets.

## setup-kubermatic-in-kind.sh

This script creates a local kind cluster, compiles the KKP binaries,
creates all Docker images and loads them into the kind cluster,
then installs KKP using the KKP installer + operator and sets up a
single shared master/seed system.
This serves as the precursor for all other tests.

This script should be sourced, not called, so callers get the variables
it sets.

## setup-kubermatic-mla-in-kind.sh

This script creates a local kind cluster, compiles the KKP binaries,
creates all Docker images and loads them into the kind cluster,
then installs KKP using the KKP installer + operator and sets up a
single shared master/seed system.
This serves as the precursor for all other tests.

This script should be sourced, not called, so callers get the variables
it sets.

## test-github-release.sh

This script is used for an optional presubmit to test changes to
the GitHub release logic before they are merged. The script will
perform all steps for a release *except* actually communicating
with GitHub.

## test-helm-charts.sh

This script runs whenever one or more Helm charts were updated.
For every changed chart in a PR, it tries to find a `test/` directory
inside the chart and then execute it. The purpose is to run some
static tests for our Helm charts, as not all of them are tested
in the conformance tests.

## trivy-scan.sh

TBD

## update-docs.sh

Updates the docs repository by copying over a couple of generated
files, like CRD examples and the Prometheus runbook.

## upload-gocache.sh

Runs as a postsubmit and refreshes the gocache by downloading the
previous version, compiling everything and then tar'ing up the
Go cache again.

## verify.sh

This script is used as a presubmit to check that Helm chart versions
have been updated if charts have been modified. Without the Prow env
vars, this script won't run properly.

## verify-user-cluster-prometheus-configs.sh

This ensures that the Prometheus rules deployed into userclusters
are valid Prometheus rules.

## run-default-application-e2e-test.sh

This script triggers and monitors Prow jobs for end-to-end (E2E) testing of applications from the default application catalog.
Each Prow job verifies the successful installation of an ApplicationInstallation object, checks its conditions for a healthy state,
ensures a Helm release has been deployed, and confirms that the application's pods are running correctly.