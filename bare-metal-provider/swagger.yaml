swagger: '2.0'
info:
  version: "1.0"
  title: Kubermatic Bare-metal Provider
paths:
  /nodes:
    post:
      description: Registeres the machine in the provider
      parameters:
        - 
          name: body
          in: body
          description: Node information
          schema:
            "$ref": "#/definitions/create_node"
      responses:
        201:
          description: Node created/registered
          schema:
            "$ref": "#/definitions/node"
  /nodes/{id}:
    get:
      description: Returns the node information of a registered node
      parameters:
        - name: id
          in: path
          required: true
          description: Node information
          type: string
      responses:
        200:
          description: Node
          schema:
            "$ref": "#/definitions/node"
        404:
          description: Node does not exist
  /nodes/{id}/cluster:
    get:
      description: Returns information about a kubernetes cluster the node should connect to
      parameters:
        - name: id
          in: path
          required: true
          description: Node id
          type: string
      responses:
        200:
          description: Cluster
          schema:
            "$ref": "#/definitions/cluster"
        404:
          description: Not is not assigned to a cluster
  /clusters:
    post:
      description: Creates a kubernetes cluster
      parameters:
        -
          name: body
          in: body
          description: Cluster information
          schema:
            "$ref": "#/definitions/cluster"
      responses:
        201:
          description: Cluster created
          schema:
            "$ref": "#/definitions/cluster"
        400:
          description: Cluster already exist
  /clusters/{name}:
    get:
      description: Returns a cluster specified by the name
      parameters:
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
      responses:
        200:
          description: Cluster
          schema:
            "$ref": "#/definitions/cluster"
        404:
          description: Cluster does not exist
    delete:
      description: Deletes all nodes from the cluster and finally deletes the cluster itself
      parameters:
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
      responses:
        200:
          description: Cluster deleted
        404:
          description: Cluster does not exist
    put:
      description: Updates the cluster
      parameters:
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
        -
          name: body
          in: body
          description: Cluster information
          schema:
            "$ref": "#/definitions/update_cluster"
      responses:
        200:
          description: Cluster updated
        404:
          description: Cluster does not exist
  /clusters/{name}/nodes:
    post:
      description: Assignes nodes to the cluster
      parameters:
        -
          name: body
          in: body
          description: Assign nodes request
          schema:
            "$ref": "#/definitions/assign_nodes"
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
      responses:
        201:
          description: Nodes assigned
          schema:
            "$ref": "#/definitions/node_list"
        416:
          description: Not enough free nodes
    get:
      description: Returns all nodes assigned to the cluster
      parameters:
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
      responses:
        200:
          description: List of nodes
          schema:
            "$ref": "#/definitions/node_list"
        404:
          description: Cluster does not exist
  /clusters/{name}/nodes/{id}:
    delete:
      description: Deletes a node from a cluster
      parameters:
        - name: name
          in: path
          required: true
          description: Cluster name
          type: string
        - name: id
          in: path
          required: true
          description: Node id
          type: string
      responses:
        200:
          description: Node deleted
        404:
          description: Node does not exist
  /free-nodes:
    get:
      description: Returns number of free/unassigned nodes
      responses:
        200:
          description: Free nodes
          schema:
            "$ref": "#/definitions/free_nodes"
definitions:
  node:
    type: object
    properties:
      id:
        type: string
      memory: 
        type: integer
      space:
        type: integer
      remote_address:
        type: string
      last_heartbeat:
        type: integer
      cpus:
        type: array
        items:
          type: object
          properties:
            cores:
              type: integer
            frequency:
              type: number
  create_node:
    type: object
    properties:
      id:
        type: string
      public_ip:
        type: string
      memory:
        type: integer
      space:
        type: integer
      cpus:
        type: array
        items:
          type: object
          properties:
            cores:
              type: integer
            frequency:
              type: number
  node_list:
    type: array
    items:
      "$ref": "#/definitions/node"
  cluster:
    type: object
    properties:
      name:
        type: string
      apiserver_url:
        type: string
      kubeconfig:
        type: string
      apiserver_ssh_pub_key:
        type: string
      ssh_pub_keys:
        type: array
        items:
          type: string
  update_cluster:
    type: object
    properties:
      apiserver_url:
        type: string
      kubeconfig:
        type: string
      apiserver_ssh_pub_key:
        type: string
      ssh_pub_keys:
        type: array
        items:
          type: "string"
  assign_nodes:
    type: object
    properties:
      number:
        type: integer
  free_nodes:
    type: array
    items:
      "$ref": "#/definitions/node"
